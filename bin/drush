#!/usr/bin/env bash
# bin/drush â€” run project Drush inside the PHP container, from the repo docroot.
set -euo pipefail

# Load env (optional)
[[ -f .env ]] && { set -a; . ./.env; set +a; }

# Defaults; DRUSH_SERVICE can override which service to exec into
: "${PHP_SERVICE:=php81-apache}"
: "${DRUSH_SERVICE:=${PHP_SERVICE}}"
: "${DRUPAL_CONTAINER_PATH:=/var/www/miraweb2024}"

# Prefer matching your host UID/GID so generated files aren't root-owned
: "${HOST_UID:=$(id -u)}"
: "${HOST_GID:=$(id -g)}"

# Make sure the DB and web container are up (no-op if already running)
docker compose up -d mysql "${DRUSH_SERVICE}" >/dev/null

# Execute Drush from the project (composer-installed) binary
exec docker compose exec -T \
  -u "${HOST_UID}:${HOST_GID}" \
  -w "${DRUPAL_CONTAINER_PATH}" \
  "${DRUSH_SERVICE}" ./vendor/bin/drush "$@"

